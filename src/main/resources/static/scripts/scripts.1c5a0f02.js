var API=function(){"use strict";var a="GET",b="POST",c="/login/token/refresh/",d="/login/token/regenerate/",e="/login/signin/",f="/login/signup/",g="/api/v1/user/",h="/api/v1/board/all/",i="/api/v1/board/",j="/api/v1/board/all",k="/api/v1/board/comment/",l="/api/v1/board/upload/board",m="/api/v1/board/upload/edited/board",n="/api/v1/board/delete/",o="/api/v1/board/upload/image/",p="/api/v1/board/download/",q="/api/v1/board/comment/";return{GET:a,POST:b,postRefreshToken:c,postRegenerateToken:d,postSignin:e,postSignUp:f,postUserInfo:g,getTeam:h,getBoard:i,getBoardAll:j,getComment:k,postUploadBoard:l,postUploadEditedBoard:m,getDeleteBoard:n,postUploadImage:o,getDownloadImage:p,postComment:q}}(API),GLOBALFLAG=function(){"use strict";var a=!1;return{loginFlag:a}}(GLOBALFLAG),TASK_USER=function(){"use strict";function a(a,b,c,d,e,f){b({url:API.postUserInfo,method:"POST",data:{email:c}}).success(function(b){console.log("postUserInfo userInfo :",b),d.put("userInfo",a.toJson(b)),e.loginFlag=!0,f.path("/")}).error(function(a){console.log("error : ",a)})}return{postUserInfo:a}}(TASK_USER),TASK_BOARD=function(){"use strict";function a(a,b,c,d){var e=new FormData;e.append("file",d[0]),a({url:API.postUploadImage,method:API.POST,data:e,transformRequest:angular.identity,headers:{"Content-Type":void 0}}).success(function(a){if(console.log("data :",a),""!==a.message){var c=a.message,d=API.getDownloadImage+c;b.editor.summernote("editor.insertImage",d,c)}}).error(function(a){console.log("data : ",a)})}function b(a,b,c,d,e){var f=angular.fromJson(d.get("userInfo"));console.log("userInfo :",f),""!==a.content&&b({url:API.postUploadBoard,method:API.POST,data:{title:a.title,email:f.email,uploadDate:new Date,content:a.content,authorId:f.idx}}).success(function(a){console.log("data : ",a),c.path(e)}).error(function(a){console.log("error : ",a)})}function c(a,b,c,d,e,f,g){c({url:API.postUploadEditedBoard,method:API.POST,data:{idx:e,title:f,updatedDate:new Date,content:g}}).success(function(a){console.log("success : ",a),b.reload()}).error(function(a){console.log("error : ",a)})}function d(a,b,c,d){b({url:API.getDeleteBoard+d,method:API.GET}).success(function(b){console.log("success : ",b),a.path("/board/boardlist")}).error(function(a){console.log("error : ",a)})}return{imageUpload:a,uploadBoard:b,uploadEditedBoard:c,deleteBoard:d}}(TASK_BOARD);angular.module("appApp",["ngAnimate","ngCookies","ngResource","ngRoute","ngSanitize","ngTouch","ngSanitize","summernote","blockUI","angularModalService","angular-jwt"]).config(["$routeProvider","$httpProvider",function(a,b){a.when("/",{templateUrl:"views/main/main.html",controller:"MainCtrl",controllerAs:"main/main"}).when("/about",{templateUrl:"views/about/about.html",controller:"AboutCtrl",controllerAs:"about/about",authenticated:!0}).when("/login",{templateUrl:"views/login/login.html",controller:"LoginCtrl",controllerAs:"login/login"}).when("/signup",{templateUrl:"views/signup/signup.html",controller:"SignupCtrl",controllerAs:"signup/signup"}).when("/board/boardlist",{templateUrl:"views/board/boardlist.html",controller:"BoardlistCtrl",controllerAs:"board/boardlist"}).when("/board/:idx",{templateUrl:"views/board/board.html",controller:"BoardCtrl",controllerAs:"board/board"}).otherwise({redirectTo:"/"}),b.defaults.useXDomain=!0}]).run(["$rootScope","$http","$location","$cookies","$window","jwtHelper","$interval",function(a,b,c,d,e,f,g){a.loginFlag=!1;var h=function(){var c=d.get("token"),e=d.get("refreshToken");if(c&&!f.isTokenExpired(c))a.loginFlag=!0,b.defaults.headers.common.Authorization="Bearer "+d.get("token");else if(e&&!f.isTokenExpired(e)){var g=f.decodeToken(e);b({url:API.postRefreshToken,method:API.POST,data:{email:g.iss,role:g.roles,refreshToken:e}}).success(function(c){a.loginFlag=!0,d.remove("token"),d.remove("refreshToken");var e="Bearer "+c.token;d.put("token",c.token,{expires:f.getTokenExpirationDate(c.token)}),d.put("refreshToken",c.refreshToken,{expires:f.getTokenExpirationDate(c.refreshToken)}),b.defaults.headers.common.Authorization=e}).error(function(a,b){400===b&&(d.remove("token"),d.remove("refreshToken"))})}else d.remove("token"),d.remove("refreshToken")};h(),a.$on("$locationChangeStart",function(){var a=[""],b=-1===a.indexOf(c.path()),e=["/"],f=-1===e.indexOf(c.path()),g=["/board/boardlist"],h=-1===g.indexOf(c.path());b&&f&&h&&!d.get("token")&&c.path("/login")});var i=!1;$(document).keydown(function(a){(82===a.keyCode&&a.ctrlKey||116===a.keyCode)&&(i=!0)}),e.onbeforeunload=function(){i||d.remove("token")};var j=function(){var c=d.get("token"),e=d.get("refreshToken"),g=!1;if(e&&(g=!0),c&&!f.isTokenExpired(c)){var h=f.decodeToken(c);b({url:API.postRegenerateToken,method:API.POST,data:{email:h.iss,role:h.roles,remember:g,token:c}}).success(function(a){var c="Bearer "+a.token;d.put("token",a.token,{expires:f.getTokenExpirationDate(a.token)}),""!==a.refreshToken&&d.put("refreshToken",a.refreshToken,{expires:f.getTokenExpirationDate(a.refreshToken)}),b.defaults.headers.common.Authorization=c}).error(function(b,c){400===c&&(d.remove("token"),d.remove("refreshToken"),a.loginFlag=!1)})}else d.remove("token"),d.remove("refreshToken"),a.loginFlag=!1};g(function(){j()},36e5)}]).controller("IndexCtrl",["$scope","$http","$route","$location","$rootScope","$cookies",function(a,b,c,d,e,f){a.currentPath="/",e.$on("$locationChangeStart",function(){a.currentPath=d.path(),"/"!==a.currentPath?$(".navbar-default").css("background-color","#FFFFFF"):$(".navbar-default").css("background-color","rgba(255, 255, 255, .0 )")}),a.init=function(){},a.init(),a.logout=function(){f.remove("userInfo"),f.remove("token"),f.remove("refreshToken"),b.defaults.headers.common.Authorization="",e.loginFlag=!1,d.path("/"),c.reload()},$(window).scroll(function(){var b=$(window).scrollTop();"/"===a.currentPath&&(b>=100?$(".navbar-default").css("background-color","#FFFFFF"):$(".navbar-default").css("background-color","rgba(255, 255, 255, .0 )"))})}]),angular.module("appApp").controller("MainCtrl",["$scope","$http","$location","$cookies",function(a,b,c,d){a.init=function(){b({url:API.getTeam,method:"GET"}).success(function(b){a.boards=b}).error(function(a){console.log("error : ",a)})},a.init()}]),angular.module("appApp").controller("AboutCtrl",["$scope","$http","$location","$cookies",function(a,b,c,d){a.content="",a.init=void 0,a.change=function(b){a.content=b},a.imageUpload=function(c){TASK_BOARD.imageUpload(b,a,d,c)},a.uploadBoard=function(){var e="/board/boardlist";TASK_BOARD.uploadBoard(a,b,c,d,e)}}]),angular.module("appApp").controller("LoginCtrl",["$scope","$http","$location","$cookies","$timeout","$rootScope","ModalService","jwtHelper",function(a,b,c,d,e,f,g,h){a.authorization="",a.pwHidden=!1,a.remember=!1,a.submit=function(){a.email,a.password;a.form.$valid?(console.log(" $scope.remember :",a.remember),b({url:API.postSignin,method:"POST",data:{email:a.email,password:a.password,remember:a.remember}}).success(function(e,g,i,j){a.authorization="Bearer "+e.token,d.put("token",e.token,{expires:h.getTokenExpirationDate(e.token)}),""!==e.refreshToken&&d.put("refreshToken",e.refreshToken,{expires:h.getTokenExpirationDate(e.refreshToken)}),b.defaults.headers.common.Authorization=a.authorization,TASK_USER.postUserInfo(angular,b,a.email,d,f,c)}).error(function(b,c,d,e){400===c&&g.showModal({templateUrl:"views/global/loginModal.html",controller:"loginModalController"}).then(function(b){b.element.modal(),a.password=""})})):a.pwHidden=!0},a.signUp=function(){c.path("/signup")}}]),angular.module("appApp").controller("SignupCtrl",["$scope","$http","$location","ModalService",function(a,b,c,d){a.pwHidden=!1,a.submit=function(){console.log("userName : "+a.userName),console.log("email : "+a.email),console.log("password : "+a.password),console.log("confirmPassword : "+a.confirmPassword),a.form.$valid?a.password===a.confirmPassword?b({url:API.postSignUp,method:"POST",data:{name:a.userName,email:a.email,password:a.password}}).success(function(a,b,d,e){console.log("success data : ",a),201===b&&c.path("/login")}).error(function(b,c,e,f){400===c?d.showModal({templateUrl:"views/global/signupAlreadyUserModal.html",controller:"signupAlreadyUserModalController"}).then(function(b){b.element.modal(),a.initForm()}):alter(b)}):d.showModal({templateUrl:"views/global/signupInvalidPasswordModal.html",controller:"signupInvalidPasswordModalController"}).then(function(b){b.element.modal(),a.initPassword()}):a.pwHidden=!0},a.initPassword=function(){a.password="",a.confirmPassword=""},a.initForm=function(){a.email="",a.password="",a.confirmPassword=""},a.hidePwErrorMsg=function(){a.pwHidden=!1}}]),angular.module("appApp").controller("BoardlistCtrl",["$scope","$http","$location","$cookies",function(a,b,c,d){a.init=function(){console.log("BoardlistCtrl init"),b({url:API.getBoardAll,method:"GET"}).success(function(b){a.boards=b,console.log("board : ",b)}).error(function(a){console.log("error : ",a)})},a.init(),a.findById=function(a){c.path("/board/"+a)}}]),angular.module("appApp").controller("BoardCtrl",["$scope","$route","$http","$location","$routeParams","$sce","$cookies",function(a,b,c,d,e,f,g){function h(){c({url:API.getBoard+a.idx,method:"GET"}).success(function(b){console.log("board : ",b),a.content=f.trustAsHtml(b.content),a.text=b.content,a.title=b.title,a.email=b.email,a.readCount=b.readCount,a.uploadDate=b.uploadDate,j(b.email)}).error(function(a){console.log("error : ",a)})}function i(){c({url:API.getComment+a.idx,method:"GET"}).success(function(b){a.comments=b,console.log("comments : ",b)}).error(function(a){console.log("error : ",a)})}function j(b){var c=angular.fromJson(g.get("userInfo"));b===c.email&&(a.isAuthor=!0)}a.idx=e.idx,a.comments=null,a.hidden=!0,a.isAuthor=!1,a.editedContent="",a.init=function(){h(),i()}(),a.edit=function(){a.hidden=!1},a["delete"]=function(){TASK_BOARD.deleteBoard(d,c,g,a.idx)},a.save=function(){a.hidden=!0,TASK_BOARD.uploadEditedBoard(a,b,c,g,a.idx,a.title,a.text)},a.imageUpload=function(b){TASK_BOARD.imageUpload(c,a,g,b)},a.commentShare=function(b){var d=angular.fromJson(g.get("userInfo"));""!==a.commentContent&&c({url:API.postComment,method:"POST",data:{content:a.commentContent,email:d.email,uploadDate:new Date,board_id:a.idx}}).success(function(b,c,d,e){a.commentContent="",i()}).error(function(a,b,c,d){console.log("data : ",a),console.log("status : ",b),console.log("headers : ",c),console.log("config : ",d)})}}]),angular.module("appApp").controller("loginModalController",["$scope",function(a){a.close=function(a){return close="test"}}]),angular.module("appApp").controller("signupAlreadyUserModalController",["$scope",function(a){}]),angular.module("appApp").controller("signupInvalidPasswordModalController",["$scope",function(a){}]),angular.module("appApp").run(["$templateCache",function(a){"use strict";a.put("views/about/about.html",'<div class="container about"> <form class="form-horizontal"> <fieldset> <div class="form-group"> <div class="col-lg-11 col-lg-offset-1"> <legend>Post</legend> </div> </div> <div class="form-group"> <label for="inputTitle" class="col-lg-1 control-label">Title</label> <div class="col-lg-11"> <input type="text" ng-model="title" class="form-control" id="inputTitle" placeholder="Title"> <br> <!-- <span class="help-block">A longer block of help text that breaks onto a new line and may extend beyond one line.</span> --> </div> </div> <div class="form-group"> <label for="inputTitle" class="col-lg-1 control-label">Content</label> <div class="col-lg-11"> <summernote height="300" ng-model="text" on-change="change(contents)" on-image-upload="imageUpload(files)" editable="editable" editor="editor"></summernote> </div> </div> <div class="form-group"> <div class="col-lg-11 col-lg-offset-1"> <button type="reset" class="btn btn-default">Cancel</button> <button type="submit" class="btn btn-primary" ng-click="uploadBoard()">Submit</button> </div> </div> </fieldset> </form> </div>'),a.put("views/board/board.html",'<!-- Post Content --> <article class="board"> <div class="container"> <div class="row"> <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1 con_view"> <span ng-hide="!hidden"> <h2 class="post-title"> {{title}} </h2> </span> <span ng-hide="hidden"> <input type="text" ng-model="title" class="form-control" id="inputTitle" placeholder="Title"> </span> <h6> <i class="fa fa-clock-o" aria-hidden="true"> {{uploadDate | date:\'yyyy-MM-dd\'}}</i> &nbsp;&nbsp;&nbsp; <i class="fa fa-eye" aria-hidden="true"> {{readCount}}</i> &nbsp;&nbsp;&nbsp; <i class="fa fa-user" aria-hidden="true"> {{email}}</i> <br> <br> <!-- to-do 본인일 때만 하도록 한다. email로 체크해도 된다.--> <span ng-hide="!isAuthor"> <button class="btn btn-info btn-xs" ng-click="edit()" ng-hide="!hidden">edit</button> <button class="btn btn-danger btn-xs" ng-click="delete()" ng-hide="!hidden">delete</button> <button class="btn btn-success btn-xs" ng-click="save()" ng-hide="hidden">save</button> </span> </h6> <hr> <span ng-hide="!hidden"> <element ng-bind-html="content"></element> </span> <span ng-hide="hidden"> <summernote ng-hide="hidden" height="400" ng-model="text" on-change="change(contents)" on-image-upload="imageUpload(files)" editable="editable" editor="editor"></summernote> </span> <p>Placeholder text by <!-- <a href="http://spaceipsum.com/">Space Ipsum</a>.--> {{email}} </p> <hr> </div> <div class="row"> <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1"> Comment <div class="widget-area no-padding blank"> <div class="status-upload"> <form name="form" id="commentForm"> <textarea placeholder="Add Comment" ng-model="commentContent"></textarea> <button class="btn btn-success green" ng-click="commentShare(form)"> <i class="fa fa-share"></i> Share</button> </form> </div> </div> </div> </div> <div class="row"> <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1"> <div class="panel panel-white post"> <div class="post-footer"> <ul class="comments-list"> <li class="comment" ng-repeat="comment in comments | orderBy: \'uploadDate\':true "> <a class="pull-left" href="#"> <img class="avatar" src="http://bootdey.com/img/Content/user_3.jpg" alt="avatar"> </a> <div class="comment-body"> <div class="comment-heading"> <h4 class="user">{{comment.email}}</h4> <h5 class="time">{{comment.uploadDate | date:\'yyyy-MM-dd HH:mm:ss\'}}</h5> </div> <p>{{comment.content}}</p> </div> </li> </ul> </div> </div> </div> </div> </div> </div> </article>'),a.put("views/board/boardlist.html",'<!-- Main Content --> <div class="container boardlist"> <div class="row"> <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1"> <div ng-repeat="board in boards | orderBy: \'uploadDate\':true "> <div class="post-preview"> <a href="" ng-click="findById(board.idx)"> <h2 class="post-title"> {{board.title}} </h2> <h3 class="post-subtitle"> Problems look mighty small from 150 miles up </h3> </a> <p class="post-meta">Posted by <a href="#/board">{{board.email}}</a> {{board.uploadDate | date:\'yyyy-MM-dd\'}}</p> </div> <hr> </div> <ul class="pager"> <li class="next"> <a href="#/board">Older Posts &rarr;</a> </li> </ul> </div> </div> </div>'),a.put("views/global/loginModal.html",'<div class="modal fade" ng-controller="loginModalController"> <div class="modal-dialog"> <div class="modal-content"> <div class="modal-header"> <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button> <h4 class="modal-title">Login Notification</h4> </div> <div class="modal-body"> <!-- to-do i18n 처리하기 --> <p>Check your ID or Password.</p> </div> <div class="modal-footer"> <button type="button" class="btn btn-success" data-dismiss="modal" ng-click="close(\'Yes\')">Ok</button> </div> </div> </div> </div>'),a.put("views/global/signupAlreadyUserModal.html",'<div class="modal fade" ng-controller="signupAlreadyUserModalController"> <div class="modal-dialog"> <div class="modal-content"> <div class="modal-header"> <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button> <h4 class="modal-title">Sign Up Notification</h4> </div> <div class="modal-body"> <!-- to-do i18n 처리하기 --> <p>The user already exists.</p> </div> <div class="modal-footer"> <button type="button" class="btn btn-success" data-dismiss="modal" ng-click="close(\'Yes\')">Ok</button> </div> </div> </div> </div>'),a.put("views/global/signupInvalidPasswordModal.html",'<div class="modal fade" ng-controller="signupInvalidPasswordModalController"> <div class="modal-dialog"> <div class="modal-content"> <div class="modal-header"> <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button> <h4 class="modal-title">Sign Up Notification</h4> </div> <div class="modal-body"> <!-- to-do i18n 처리하기 --> <p>Password and confirmed password do not match.</p> </div> <div class="modal-footer"> <button type="button" class="btn btn-success" data-dismiss="modal" ng-click="close(\'Yes\')">Ok</button> </div> </div> </div> </div>'),a.put("views/login/login.html",'<div class="container login"> <div class="row"> <div class="col-md-4 col-md-offset-4"> <div class="panel panel-default"> <div class="panel-heading"> <h3 class="panel-title">Login via site</h3> </div> <div class="panel-body"> <form accept-charset="UTF-8" role="form" name="form" ng-submit="submit()"> <fieldset> <div class="input-group margin-bottom-sm"> <span class="input-group-addon"> <i class="fa fa-envelope-o fa-fw"></i> </span> <input class="form-control" type="email" placeholder="Email address" autofocus ng-model="email" ng-required="true"> </div> <div class="input-group"> <span class="input-group-addon"> <i class="fa fa-key fa-fw"></i> </span> <input class="form-control" name="password" type="password" placeholder="Password" ng-click="hidePwErrorMsg()" ng-model="password" ng-required="true" ng-pattern="/^(?=.*\\d)(?=.*[a-z])/" ng-minlength="6" ng-maxlength="20"> </div> <div ng-hidden="pwHidden" ng-show="pwHidden" class="col-xs-12 col-md-12 alert alert-warning" role="alert"> Password must be 6 to 20 characters in length and include Numbers. </div> <div class="checkbox"> <label> <input name="remember" type="checkbox" value="Remember Me" ng-model="remember"> Remember Me </label> <a class="pull-right" href="">Forgot password?</a> </div> <input class="btn btn-lg btn-success btn-block" type="submit" value="Login"> </fieldset> </form> <hr> <center> <!-- <h4>OR</h4> --> </center> <!-- <input class="btn btn-lg btn-facebook btn-block" ng-click="test()" value="Login via facebook"> --> <input class="btn btn-lg btn-signup btn-block" ng-click="signUp()" value="Sign Up"> </div> </div> </div> </div> </div>'),a.put("views/main/main.html",'<div class="container mainpage"> <div class="row text-center"> <div class="left-panel"> <div class="col-md-4" ng-repeat="board in boards | orderBy:uploadDate:true | limitTo:6"> <div class="panel panel-default"> <div class="panel-body"> <div class="thumbnail"> <a href="#"><img src="http://www.istanbluegayrimenkul.com/wp-content/uploads/2014/05/image6.jpg" alt=""></a> </div> <!-- a태그를 빼면 된다. --> <a href="#"> <h3>{{board.title}}</h3> </a> </div> </div> </div> </div> </div></div>'),a.put("views/signup/signup.html",'<div class="container signup"> <div class="row"> <div class="col-md-4 col-md-offset-4"> <div class="panel panel-default"> <div class="panel-heading"> <h3 class="panel-title">Create a new account</h3> </div> <div class="panel-body"> <form accept-charset="UTF-8" role="form" name="form" ng-submit="submit()"> <fieldset> <!-- Username --> <div class="input-group margin-bottom-sm"> <span class="input-group-addon"> <i class="fa fa-user fa-fw" aria-hidden="true"></i> </span> <input class="form-control" type="text" name="username" placeholder="User Name" autofocus ng-required="true" ng-model="userName" ng-pattern="/^[ㄱ-ㅎ|가-힣|a-z|A-Z|0-9|\\*]+$/"> </div> <div ng-show="form.username.$error.pattern" class="col-xs-12 col-md-12 alert alert-warning" role="alert"> Cannot contain any special characters. </div> <br> <!-- Your Email --> <div class="input-group margin-bottom-sm"> <span class="input-group-addon"> <i class="fa fa-envelope-o fa-fw"></i> </span> <input class="form-control" type="email" placeholder="Email Address" ng-required="true" ng-model="email"> </div> <br> <!-- Password --> <div class="input-group"> <span class="input-group-addon"> <i class="fa fa-key fa-fw"></i> </span> <input class="form-control" name="password" type="password" placeholder="Password" ng-click="hidePwErrorMsg()" ng-required="true" ng-model="password" ng-pattern="/^(?=.*\\d)(?=.*[a-z])/" ng-minlength="6" ng-maxlength="20"> </div> <div ng-show="form.password.$error.pattern" class="col-xs-12 col-md-12 alert alert-warning" role="alert"> Password must be 6 to 20 characters in length and include Numbers. </div> <br> <!-- Confirm Password --> <div class="input-group"> <span class="input-group-addon"> <i class="fa fa-key fa-fw"></i> </span> <input class="form-control" type="password" placeholder="Confirm Password" ng-required="true" ng-model="confirmPassword" ng-pattern="/^(?=.*\\d)(?=.*[a-z])/" ng-minlength="6" ng-maxlength="20"> </div> <br> <input class="btn btn-lg btn-success btn-block" type="submit" value="Create your account"> </fieldset> </form> </div> </div> </div> </div> </div>')}]);